<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Module2_concentration â€¢ rfasst</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Module2_concentration">
<meta property="og:description" content="rfasst">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rfasst</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-clipboard-list"></span>
     
    Guides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Module1_emissions.html">Module1 emissions</a>
    </li>
    <li>
      <a href="../articles/Module2_concentration.html">Module2 concentration</a>
    </li>
    <li>
      <a href="../articles/Module3_health.html">Module3 health</a>
    </li>
    <li>
      <a href="../articles/Module4_agriculture.html">Module4 agriculture</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/rfasst/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Module2_concentration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Module2_concentration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/rfasst/blob/master/vignettes/Module2_concentration.Rmd"><code>vignettes/Module2_concentration.Rmd</code></a></small>
      <div class="hidden name"><code>Module2_concentration.Rmd</code></div>

    </div>

    
    
<p>The functions that form this module take the emission sets per TM5-FASST region and year generated in Module 1 (by <code>m1_emissions_rescale</code>), and estimate the fine particulate matter (PM2.5) and ozone (O3) concentration levels for each period and TM5-FASST region. In particular the package reports the following range of PM2.5 and O3 indicators:</p>
<p>Fine particulate matter (PM2.5) concentration levels (<code>m2_get_conc_pm25</code>)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/rfasst">rfasst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># db_path&lt;-"path_to_your_gcam_database"</span>
<span class="co"># query_path&lt;-"path_to_your_gcam_queries_file"</span>
<span class="co"># db_name&lt;-"name of the database"</span>
<span class="co"># prj_name&lt;-"name for a Project to add extracted results to" (any name should work, avoid spaces just in case) </span>
<span class="co"># scen_name&lt;-"name of the GCAM scenario"</span>
<span class="co"># queries&lt;-"Name of the query file" (the package includes a default query file that includes all the queries required in every function in the packae, "queries_rfasst.xml")</span>
<span class="co"># saveOutput: Writes the files.By default=T</span>
<span class="co"># map: Produce the maps. By default=F</span>

  <span class="co"># To write the csv files into the output folder:</span>

    <span class="co"># m2_get_conc_pm25(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=T,map=F) </span>

  <span class="co"># To save as data frame pm2.5 concentration levels by TM5-FASST region in year 2050:</span>

    <span class="co"># pm25.conc.2050&lt;-dplyr::bind_rows(m2_get_conc_pm25(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=F)) %&gt;% dplyr::filter(year==2050) </span>
                         
    <span class="co"># head(pm25.conc.2050)</span></code></pre></div>
<ul>
<li>Ozone concentration levels (<code>m2_get_conc_o3</code>)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/rfasst">rfasst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># db_path&lt;-"path_to_your_gcam_database"</span>
<span class="co"># query_path&lt;-"path_to_your_gcam_queries_file"</span>
<span class="co"># db_name&lt;-"name of the database"</span>
<span class="co"># prj_name&lt;-"name for a Project to add extracted results to" (any name should work, avoid spaces just in case) </span>
<span class="co"># scen_name&lt;-"name of the GCAM scenario",</span>
<span class="co"># queries&lt;-"Name of the query file" (the package includes a default query file that includes all the queries required in every function in the packae, "queries_rfasst.xml")</span>
<span class="co"># saveOutput: Writes the files.By default=T</span>
<span class="co"># map: Produce the maps. By default=F</span>

  <span class="co"># To write the csv files into the output folder:</span>

    <span class="co"># m2_get_conc_o3(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=T,map=F) </span>

  <span class="co"># To save as data frame ozone (O3) concentration levels by TM5-FASST region in year 2050:</span>

    <span class="co"># o3.conc.2050&lt;-dplyr::bind_rows(m2_get_conc_o3(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=F)) %&gt;% dplyr::filter(year==2050) </span>
                         
    <span class="co"># head(o3.conc.2050)</span></code></pre></div>
<ul>
<li>Maximum 6-monthly running average of daily maximum hourly O3 (M6M, also known as 6mDMA1) (<code>m2_get_conc_m6m</code>)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/rfasst">rfasst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># db_path&lt;-"path_to_your_gcam_database"</span>
<span class="co"># query_path&lt;-"path_to_your_gcam_queries_file"</span>
<span class="co"># db_name&lt;-"name of the database"</span>
<span class="co"># prj_name&lt;-"name for a Project to add extracted results to" (any name should work, avoid spaces just in case) </span>
<span class="co"># scen_name&lt;-"name of the GCAM scenario",</span>
<span class="co"># queries&lt;-"Name of the query file" (the package includes a default query file that includes all the queries required in every function in the packae, "queries_rfasst.xml")</span>
<span class="co"># saveOutput: Writes the files.By default=T</span>
<span class="co"># map: Produce the maps. By default=F</span>

  <span class="co"># To write the csv files into the output folder:</span>

    <span class="co"># m2_get_conc_m6m(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=T,map=F) </span>

  <span class="co"># To save as data frame ozone-M6M (6mDMAI) concentration levels by TM5-FASST region in year 2050:</span>

    <span class="co"># m6m.conc.2050&lt;-dplyr::bind_rows(m2_get_conc_m6m(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=F)) %&gt;% dplyr::filter(year==2050) </span>
                         
    <span class="co"># head(m6m.conc.2050)</span></code></pre></div>
<ul>
<li>Accumulated daytime hourly O3 concentration above a threshold of 40 ppbV (AOT40) (<code>m2_get_conc_aot40</code>)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/rfasst">rfasst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># db_path&lt;-"path_to_your_gcam_database"</span>
<span class="co"># query_path&lt;-"path_to_your_gcam_queries_file"</span>
<span class="co"># db_name&lt;-"name of the database"</span>
<span class="co"># prj_name&lt;-"name for a Project to add extracted results to" (any name should work, avoid spaces just in case) </span>
<span class="co"># scen_name&lt;-"name of the GCAM scenario",</span>
<span class="co"># queries&lt;-"Name of the query file" (the package includes a default query file that includes all the queries required in every function in the packae, "queries_rfasst.xml")</span>
<span class="co"># saveOutput: Writes the files.By default=T</span>
<span class="co"># map: Produce the maps. By default=F</span>

  <span class="co"># To write the csv files into the output folder:</span>

    <span class="co"># m2_get_conc_aot40(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=T,map=F) </span>

  <span class="co"># To save as data frame ozone-AOT40 concentration levels by TM5-FASST region in year 2050:</span>

    <span class="co"># aot40.conc.2050&lt;-dplyr::bind_rows(m2_get_conc_aot40(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=F)) %&gt;% dplyr::filter(year==2050) </span>
                         
    <span class="co"># head(aot40.conc.2050)</span></code></pre></div>
<ul>
<li>Seasonal mean daytime O3 concentration (<code>m2_get_conc_mi</code>)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/rfasst">rfasst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># db_path&lt;-"path_to_your_gcam_database"</span>
<span class="co"># query_path&lt;-"path_to_your_gcam_queries_file"</span>
<span class="co"># db_name&lt;-"name of the database"</span>
<span class="co"># prj_name&lt;-"name for a Project to add extracted results to" (any name should work, avoid spaces just in case) </span>
<span class="co"># scen_name&lt;-"name of the GCAM scenario",</span>
<span class="co"># queries&lt;-"Name of the query file" (the package includes a default query file that includes all the queries required in every function in the packae, "queries_rfasst.xml")</span>
<span class="co"># saveOutput: Writes the files.By default=T</span>
<span class="co"># map: Produce the maps. By default=F</span>

  <span class="co"># To write the csv files into the output folder:</span>

    <span class="co"># m2_get_conc_mi(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=T,map=F) </span>

  <span class="co"># To save as data frame ozone-Mi concentration levels by TM5-FASST region in year 2050:</span>

    <span class="co"># mi.conc.2050&lt;-dplyr::bind_rows(m2_get_conc_mi(db_path,query_path,db_name,prj_name,scen_name,queries,saveOutput=F)) %&gt;% dplyr::filter(year==2050) </span>
                         
    <span class="co"># head(mi.conc.2050)</span></code></pre></div>
In addition, for all these function, the package allows to produce different figures and/or animations, generated using the <a href="https://github.com/JGCRI/rmap">rmap</a> package documented in the following <a href="jgcri.github.io/rmap/">page</a>. To generate these maps, the user needs to include the <code>map=T</code> parameter, and they will be generated and stored in the corresponding output sub-directory. As an example for this module, the following map shows the PM2.5 concentrations in 2050: <!--------------------------> <!-------------------------->
<p align="center" style="font-size:18px;">
<em>PM2.5 concntration by region in 2050 (ug/m3)</em>
</p>
<p align="center">
<img src="https://github.com/JGCRI/rfasst/tree/main/vignettes/vignetteFigs/PM2.5_concentration_2050.png"></p>
<!-------------------------->
<!-------------------------->
<p>As indicated in the documentation of TM5-FASST <a href="https://acp.copernicus.org/articles/18/16173/2018/acp-18-16173-2018-discussion.html">Van Dingenen et al 2018</a>,estimates of PM2.5 and O3 concentration levels in a receptor region driven by the emissions of different precursors in different sources are based on parametrizations of meteorology and atmospheric chemistry drawn from the more complex TM5 model. In summary, as explained in <a href="https://www.sciencedirect.com/science/article/pii/S1352231020302739">Sampedro et al 2020</a>, concentrations of a pollutant <span class="math inline">\(j\)</span>, in region <span class="math inline">\(y\)</span>, from all the precursors (<span class="math inline">\(i\)</span>) emitted in all regions (<span class="math inline">\(x_k\)</span>), is calculated as:</p>
<p><span class="math display">\[C_j (y)=C_{j,base} (y)+âˆ‘_{k=1}^{n_x}âˆ‘_{i=1}^{n_i}SRC_{i,j} [x_k,y]\cdot[E_i (x_k)-E_{i,base} (x_k )]\]</span></p>
<ul>
<li><p><span class="math inline">\(C_{j,base} (y)\)</span> is the base-run concentration level of pollutant j in region y, pre-computed with TM5.</p></li>
<li><p><span class="math inline">\(E_{i,base} (x_k)\)</span> are the base-run precursor i emissions in region <span class="math inline">\(x_k\)</span></p></li>
<li><p><span class="math inline">\(SRC_{i,j} [x_k,y]\)</span> = the <span class="math inline">\(i\)</span>â€“to-<span class="math inline">\(j\)</span> source-receptor coefficient for source region <span class="math inline">\(x_k\)</span> and receptor region y, pre-computed from a 20% emission reduction of component i in region <span class="math inline">\(x_k\)</span> relative to the base-run</p></li>
<li><p><span class="math inline">\(E_i (x_k)\)</span> are the emissions of precursor i in region <span class="math inline">\(x_k\)</span> in the analyzed scenario.</p></li>
</ul>
<p>Following this equation, base-run emissions and concentrations, and source-receptor coefficient matrixes need to be combined with emissions pathways for the analyzed scenario. The package includes the following input information:</p>
<ul>
<li>Source-receptor coefficient matrixes (SRC):
<ul>
<li>PM2.5 Source-receptor matrixes:
<ul>
<li>SO4: SO2, NOx and NH3</li>
<li>NO3: NOx, SO2, and NH3</li>
<li>NH4: NH3, NOx and SO2</li>
<li>BC: BC_POP</li>
<li>POM: POM_POP</li>
</ul>
</li>
<li>O3 Source-receptor matrixes:
<ul>
<li>For O3 exposure (O3): NOx, NMVOC and SO2</li>
<li>For health calculations: M6M (6mDMA1): NOx, NMVOC, SO2 and CH4</li>
<li>For agricultural damages:
<ul>
<li>AOT40: NOx, NMVOC, SO2 and CH4</li>
<li>Mi (M7 and M12): NOx, NMVOC, SO2 and CH4</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The packages also includes the base emission and concentration levels for all these indicators.</p>
<p>In addition, primary PM2.5 emissions (BC and POM) are assumed to have a more direct influence in urban (more dense) areas, so the emission-concentration relation for these two pollutants is modified using adjustment coefficients that are included in the package.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jon Sampedro.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
